{{- if not .Values.security.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "terraform-registry.fullname" . }}
  labels:
    {{- include "terraform-registry.labels" . | nindent 4 }}
type: Opaque
stringData:
  TFR_JWT_SECRET: {{ required "security.jwtSecret is required (or set security.existingSecret)" .Values.security.jwtSecret | quote }}
  ENCRYPTION_KEY: {{ required "security.encryptionKey is required (or set security.existingSecret)" .Values.security.encryptionKey | quote }}
  {{- if not .Values.externalDatabase.existingSecret }}
  TFR_DATABASE_PASSWORD: {{ required "externalDatabase.password is required (or set externalDatabase.existingSecret)" .Values.externalDatabase.password | quote }}
  {{- end }}
  {{- if and (eq .Values.storage.backend "s3") .Values.storage.s3.secretAccessKey }}
  TFR_STORAGE_S3_ACCESS_KEY_ID: {{ .Values.storage.s3.accessKeyId | quote }}
  TFR_STORAGE_S3_SECRET_ACCESS_KEY: {{ .Values.storage.s3.secretAccessKey | quote }}
  {{- end }}
  {{- if and (eq .Values.storage.backend "azure") .Values.storage.azure.accountKey }}
  TFR_STORAGE_AZURE_ACCOUNT_KEY: {{ .Values.storage.azure.accountKey | quote }}
  {{- end }}
  {{- if and .Values.auth.oidc.enabled .Values.auth.oidc.clientSecret }}
  TFR_AUTH_OIDC_CLIENT_SECRET: {{ .Values.auth.oidc.clientSecret | quote }}
  {{- end }}
  {{- if and .Values.auth.azureAd.enabled .Values.auth.azureAd.clientSecret }}
  TFR_AUTH_AZURE_AD_CLIENT_SECRET: {{ .Values.auth.azureAd.clientSecret | quote }}
  {{- end }}
{{- end }}
